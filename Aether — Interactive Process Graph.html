<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Aether — Interactive Node Graph</title>

<script data-goatcounter="https://rickclmnt.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

<style>
  :root {
    --bg: #071028;
    --muted: #8fb7d8;
    --panel: #071831;
    --accent: #5c8cff;
    --glass: rgba(255,255,255,0.03);
    --node-fill: #071a2a;
    --node-ring: #05273e;
    --node-stroke: #224b7a;
  }

  html, body {
    margin: 0;
    height: 100%;
    background: var(--bg);
    font-family: Inter, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
  }

  .wrap {
    display: flex;
    flex-direction: row;
    height: 100vh;
    gap: 12px;
    padding: 12px;
    box-sizing: border-box;
  }

  .viz {
    flex: 1;
    min-width: 360px;
    border-radius: 12px;
    overflow: hidden;
    background: linear-gradient(180deg, #041323, #08182b);
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    position: relative;
  }

  #scroll-container {
    width: 100%;
    height: 100%;
    overflow: auto;
    touch-action: auto;
  }

  svg {
    width: 2000px;
    height: 2000px;
    display: block;
    user-select: none;
    touch-action: none;
  }

  .panel {
    width: 420px;
    max-width: 45vw;
    min-width: 260px;
    background: var(--panel);
    border-radius: 12px;
    padding: 16px;
    color: #dff1ff;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    overflow: auto;
  }

  h3 {
    margin: 6px 0 10px;
    font-weight: 600;
    color: #eaf6ff;
  }

  .nodeGroup {
    cursor: grab;
    will-change: transform;
  }

  .nodeGroup.dragging { cursor: grabbing; }

  .nodeRing { fill: none; stroke: var(--node-ring); stroke-width: 12; opacity: 0.55; }
  .nodeCore { fill: var(--node-fill); stroke: var(--node-stroke); stroke-width: 2; }

  .labelText {
    fill: #dff1ff;
    font-weight: 700;
    font-size: 13px;
    text-anchor: middle;
    pointer-events: none;
  }

  .flow { stroke-linecap: round; stroke-linejoin: round; opacity: 0.92; pointer-events: none; }
  .packet { pointer-events: none; }

  .substep {
    background: rgba(255,255,255,0.03);
    padding: 8px;
    border-radius: 8px;
    margin-bottom: 8px;
    border: 1px solid rgba(255,255,255,0.03);
  }

  .small-btn {
    background: #0e2b44;
    border: none;
    padding: 6px 8px;
    border-radius: 8px;
    color: #dff1ff;
    cursor: pointer;
  }

  .trace {
    font-family: monospace;
    background: rgba(0,0,0,0.12);
    padding: 8px;
    border-radius: 6px;
    margin-top: 8px;
    white-space: pre-wrap;
    font-size: 12px;
    color: #bfe6ff;
    max-height: 260px;
    overflow: auto;
  }

  .inspector {
    margin-top: 12px;
    background: linear-gradient(180deg, rgba(9,17,28,0.6), rgba(6,12,20,0.6));
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.04);
  }

  .micrograph {
    width: 100%;
    height: 200px;
    background: rgba(0,0,0,0.06);
    border-radius: 6px;
    margin-top: 8px;
    overflow: hidden;
    position: relative;
  }

  .hint {
    position: absolute;
    left: 12px;
    bottom: 12px;
    color: #9fd8ff;
    background: rgba(0,0,0,0.25);
    padding: 6px 8px;
    border-radius: 10px;
    font-size: 13px;
  }

  /* Responsive adjustments */
  @media (max-width: 980px) { .wrap { flex-direction: column; } .panel { width: 100%; max-width: 100%; min-width: 0; } }
  @media (max-width: 760px) {
    .wrap { flex-direction: column; padding: 8px; gap: 8px; }
    .viz { width: 100%; height: 65vh; min-height: 330px; }
    .panel { width: 100%; padding: 14px; font-size: 15px; }
    h3 { font-size: 18px; }
    .nodeGroup .visual { transform: scale(0.75); }
    .labelText { font-size: 10px; transform: translateY(8px); }
    .small-btn { padding: 6px 10px; font-size: 14px; }
    .micrograph { height: 160px; }
    .hint { font-size: 11px; bottom: 8px; left: 8px; padding: 4px 6px; }
    .substep { padding: 6px; }
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="viz" id="viz">
    <div id="scroll-container">
      <svg id="svg" viewBox="0 0 1600 900" xmlns="http://www.w3.org/2000/svg" aria-label="Aether interactive graph">
        <defs>
          <linearGradient id="bg" x1="0" x2="1">
            <stop offset="0" stop-color="#041323"/>
            <stop offset="1" stop-color="#071028"/>
          </linearGradient>
          <filter id="glow"><feGaussianBlur stdDeviation="6" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <rect width="100%" height="100%" fill="url(#bg)"/>
        <g id="flows"></g>
        <g id="nodes"></g>
        <g id="packets"></g>
        <g id="labels"></g>
      </svg>
    </div>
    <div class="hint">Created by <strong>Patrick U. Clement</strong></div>
  </div>

  <div class="panel">
    <h3>Aether — Interactive Process Graph</h3>
    <div style="display:flex; gap:8px; align-items:center;">
      <div style="flex:1;">Drag nodes to reposition. Click a node to inspect internals and run microcalls.</div>
      <button id="reset" class="small-btn">Reset View</button>
    </div>
    <p>P.S. Finished at 2am, may contain minor bugs.</p>

    <div style="margin-top:12px;">
      <div style="margin-bottom:8px;"><button id="runDemo" class="small-btn">Run Demo Trace</button></div>
      <div id="details"></div>

      <div id="inspector" class="inspector" style="display:none;">
        <strong id="inspectorTitle"></strong>
        <div id="inspectorInfo" style="margin-top:8px;color:#bfe6ff"></div>
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button id="openMicro" class="small-btn">Open Micrograph</button>
          <button id="playMicro" class="small-btn">Play Microcalls</button>
        </div>
        <div id="microArea" class="micrograph"></div>
      </div>

      <div id="trace" class="trace" style="display:none"></div>
    </div>
  </div>
</div>

<script>
const svg = document.getElementById('svg');
const flowsG = document.getElementById('flows');
const nodesG = document.getElementById('nodes');
const packetsG = document.getElementById('packets');

let view = { x:0, y:0, w:1600, h:900 };
function setView(){ svg.setAttribute('viewBox', `${view.x} ${view.y} ${view.w} ${view.h}`); }
setView();

const details = document.getElementById('details');
const inspector = document.getElementById('inspector');
const inspectorTitle = document.getElementById('inspectorTitle');
const inspectorInfo = document.getElementById('inspectorInfo');
const microArea = document.getElementById('microArea');
const openMicro = document.getElementById('openMicro');
const playMicro = document.getElementById('playMicro');
const trace = document.getElementById('trace');
const resetBtn = document.getElementById('reset');
const runDemoBtn = document.getElementById('runDemo');

/* Convert screen to SVG coordinates */
function screenToSvg(evt){
  const pt = svg.createSVGPoint();
  pt.x = evt.clientX; pt.y = evt.clientY;
  return pt.matrixTransform(svg.getScreenCTM().inverse());
}

/* Mobile viewport scaling */
function adjustForMobile(){
  const viz = document.getElementById("viz");
  if(window.innerWidth<760){
    viz.classList.add("mobile-scale");
    view.w = 900;
    view.h = 900 * (window.innerHeight / window.innerWidth);
  } else {
    viz.classList.remove("mobile-scale");
    view.w = 1600;
    view.h = 900;
  }
  setView();
}
window.addEventListener('resize', adjustForMobile);
adjustForMobile();

/* -------------------- Graph Data -------------------- */
const nodesData = [
  { id:'INPUT', x:140, y:150, subs: ['tokenizer_normalizer','parser_dependency_pos_phrase','embedding_mapper','intent_classifier','semantic_similarity','ner_relation_extractor'], libs:['tokenizers','spaCy','transformers'] },
  { id:'MEMORY', x:520, y:150, subs: ['triplet_graph_store','crud_ops','weighted_edges','indexing_hashing','persistence_json_graphdb','retrieval_by_relevance'], libs:['networkx','rdflib','sqlite'] },
  { id:'REASONER', x:520, y:420, subs: ['symbolic_inference','causal_chain_constructor','hypothesis_generator','goal_planner','meta_reasoning','scoring_confidence'], libs:['sympy','custom_infer'] },
  { id:'SELF_MODEL', x:920, y:320, subs: ['introspection','consistency_validation','confidence_adjustment','identity_memory','self_updates','error_reflection'], libs:['numpy','custom_meta'] },
  { id:'RESPONSEGEN', x:1260, y:260, subs: ['compositional_grammar_engine','templates_rule_syntax','word_meaning_dict','stochastic_variation','tense_detection','aggregation_weighting','nl_mapping'], libs:['jinja2'] },
  { id:'OUTPUT', x:1460, y:320, subs: ['formatting','serialization_json','dispatch_ui_api'], libs:['json','http'] }
];

const flowPairs = [
  ['INPUT','MEMORY'], ['MEMORY','REASONER'], ['REASONER','SELF_MODEL'], ['SELF_MODEL','RESPONSEGEN'], ['RESPONSEGEN','OUTPUT']
];

const palettes = [
  ['#13c2ff','#9f5bff','#ff6ec7'],
  ['#7effc7','#00d09c','#00a88a'],
  ['#8eb6ff','#6f9cff','#9d7aff'],
  ['#ffdd57','#ff7a00','#ff3d00']
];

/* -------------------- Path Utilities -------------------- */
let pathMap = [];
function makePath(from, to, curvature=0.36){
  const dx = to.x - from.x, dy = to.y - from.y;
  const cx1 = from.x + dx*0.3 + dy*curvature;
  const cy1 = from.y + dy*0.3 - dx*curvature;
  const cx2 = from.x + dx*0.7 - dy*curvature;
  const cy2 = from.y + dy*0.7 + dx*curvature;
  return `M ${from.x} ${from.y} C ${cx1} ${cy1}, ${cx2} ${cy2}, ${to.x} ${to.y}`;
}

function createGradient(colors){
  const defs = svg.querySelector('defs');
  const id = 'g'+(defs.children.length+1);
  const lg = document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
  lg.id = id; lg.setAttribute('x1','0'); lg.setAttribute('y1','0'); lg.setAttribute('x2','1'); lg.setAttribute('y2','0');
  colors.forEach((c,i)=>{ const stop=document.createElementNS('http://www.w3.org/2000/svg','stop'); stop.setAttribute('offset',(i/(colors.length-1))*100+'%'); stop.setAttribute('stop-color',c); lg.appendChild(stop); });
  defs.appendChild(lg); return id;
}

/* -------------------- Draw Flows -------------------- */
function drawFlows(){
  flowPairs.forEach((pair, idx)=>{
    const from = nodesData.find(n=>n.id===pair[0]);
    const to = nodesData.find(n=>n.id===pair[1]);
    const pal = palettes[idx % palettes.length];
    for(let layer=0; layer<4; layer++){
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('d', makePath(from,to,0.22+layer*0.06));
      path.setAttribute('stroke','url(#'+createGradient(pal)+')');
      path.setAttribute('stroke-width',6-layer);
      path.setAttribute('fill','none');
      if(layer===0) path.setAttribute('filter','url(#glow)');
      path.classList.add('flow'); flowsG.appendChild(path);
      pathMap.push({from:pair[0],to:pair[1],path,layer,endpoints:{sx:from.x,sy:from.y,ex:to.x,ey:to.y}});
    }
  });
}

/* Update flows when node moves */
function updateFlowsForNode(nodeId){
  pathMap.forEach(entry=>{
    if(entry.from===nodeId || entry.to===nodeId){
      const from = nodesData.find(n=>n.id===entry.from);
      const to = nodesData.find(n=>n.id===entry.to);
      entry.path.setAttribute('d', makePath(from,to,0.22+entry.layer*0.06));
      entry.endpoints = { sx: from.x, sy: from.y, ex: to.x, ey: to.y };
    }
  });
}

/* -------------------- Draw Nodes -------------------- */
function drawNodes(){
  nodesData.forEach(n=>{
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.classList.add('nodeGroup'); g.setAttribute('transform', `translate(${n.x},${n.y})`); g.dataset.id = n.id;

    const visual = document.createElementNS('http://www.w3.org/2000/svg','g'); visual.classList.add('visual');
    const ring = document.createElementNS('http://www.w3.org/2000/svg','circle'); ring.setAttribute('r',56); ring.classList.add('nodeRing');
    const core = document.createElementNS('http://www.w3.org/2000/svg','circle'); core.setAttribute('r',30); core.classList.add('nodeCore');
    visual.append(ring, core);

    const label = document.createElementNS('http://www.w3.org/2000/svg','text'); label.setAttribute('y',72); label.classList.add('labelText'); label.textContent = n.id.replace('_',' ');
    g.append(visual,label); nodesG.appendChild(g);

    n.el=g; n.visual=visual; n.label=label;

    /* Click to open inspector */
    g.addEventListener('click', e=>{ if(g.dataset.dragging==='1'){ g.dataset.dragging='0'; return;} openInspector(n); e.stopPropagation(); });

    /* Dragging */
    g.addEventListener('pointerdown', evt=>{
      evt.preventDefault(); g.setPointerCapture(evt.pointerId); g.classList.add('dragging'); g.dataset.dragging='0';
      const start = screenToSvg(evt), origX=n.x, origY=n.y;
      function move(ev){ const cur=screenToSvg(ev); n.x=origX+cur.x-start.x; n.y=origY+cur.y-start.y; g.setAttribute('transform',`translate(${n.x},${n.y})`); updateFlowsForNode(n.id); g.dataset.dragging='1'; }
      function up(){ svg.removeEventListener('pointermove', move); svg.removeEventListener('pointerup', up); g.classList.remove('dragging'); }
      svg.addEventListener('pointermove', move); svg.addEventListener('pointerup', up);
    });
  });
}

/* -------------------- Initialization -------------------- */
drawFlows();
drawNodes();
</script>

</body>
</html>
